<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WebLLM Knowledge Graph Chat</title>

  <!-- Add Tailwind CSS processing -->
  <link data-trunk rel="css" href="public/output.css" />

  <!-- Include favicon in dist output: see https://trunkrs.dev/assets/#icon -->
  <link data-trunk rel="icon" href="public/favicon.ico" />

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script>
    // Ensure Lucide is loaded and initialize icons when DOM is ready
    document.addEventListener('DOMContentLoaded', function () {
      if (typeof lucide !== 'undefined' && lucide.createIcons) {
        lucide.createIcons();
      }

      // Observe DOM changes and apply Lucide icons for dynamically inserted nodes (SPA behavior)
      try {
        if (!document.body) return;

        let pending = false;
        const observer = new MutationObserver((mutations) => {
          // Only react when new nodes explicitly contain data-lucide
          const hasNewPlaceholders = mutations.some((m) => {
            if (m.type !== 'childList') return false;
            for (const node of m.addedNodes) {
              if (!(node instanceof Element)) continue;
              if (node.matches && node.matches('[data-lucide]')) return true;
              if (node.querySelector && node.querySelector('[data-lucide]')) return true;
            }
            return false;
          });

          if (!hasNewPlaceholders) return;
          if (pending) return; // debounce
          pending = true;

          // Batch updates in next frame and avoid observer feedback
          requestAnimationFrame(() => {
            try {
              observer.disconnect();
              if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
              }
            } catch (err) {
              console.warn('Lucide refresh failed:', err);
            } finally {
              pending = false;
              observer.observe(document.body, { childList: true, subtree: true });
            }
          });
        });

        observer.observe(document.body, { childList: true, subtree: true });
      } catch (e) {
        console.warn('Lucide MutationObserver setup failed:', e);
      }
    });
  </script>

  <!-- WebLLM Integration -->
  <script type="module">
    import * as webllm from "https://esm.run/@mlc-ai/web-llm";
    window.webllm = webllm;
    console.log("WebLLM loaded successfully");
  </script>

  <!-- include support for `wasm-bindgen --weak-refs` - see: https://rustwasm.github.io/docs/wasm-bindgen/reference/weak-references.html -->
  <link data-trunk rel="rust" data-wasm-opt="z" data-weak-refs />
</head>

<body></body>

</html>